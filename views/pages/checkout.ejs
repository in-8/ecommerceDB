<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<!-- font awsome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Custom CSS -->
<style>
.gradient-custom {
background-color: #05e8ba;
background-image: linear-gradient(315deg, #05e8ba 0%, #087ee1 74%);

}

.card-custom {
border-radius: 10% 1% 10%;
background-color: #f8f9fa ;
}


.input-custom {
background-color: white ;
}

.white-text {
color: hsl(52, 0%, 98%);
font-weight: 100 ;
font-size: 14px;
}

</style>
<title>LELO</title>
</head>
<body  class="container-fluid pt-5 mt-5 gradient-custom" >
<h2 class="col mt-3 text-center fs-1 text-white" >ðŸŽŠLELO CHECKOUTðŸŽŠ </h2>
<%- include('../partials/header'); %>
<%- include('../partials/errorDiv'); %>
<div class="col-12 bg-success text-white mt-2 mb-2 " onclick="hideSuccess(this)">
    <p id="successText" class="text-center fs-4"></p>
</div>
<div class="container-fluid mt-2">
<div class="row mt-2 g-2">
    <% for(let i in products){ %>
    <div id="<%= products[i].id+'parent'%>" class="col-xs-12 col-sm-4 col-lg-3 mb-3 mb-sm-0 mh-25 shadow">
        <div class="card">
            <img src="<%= products[i].image %>" class="card-img-top pt-3" height="250vh">
            <div class="card-body">
                <h5 class="card-title"><%= products[i].name %> </h5>
            </div>
            <ul class="list-group list-group-flush ">
                <li id="<%= products[i].id+'totalPriceItem'%>" class="list-group-item">Price: <b class="text-primary fs-5"><%= products[i].price*products[i].qty %></b></li>
                <li class="list-group-item d-flex justify-content-around align-content-center">
                Quantity: <b><%= products[i].qty %></b> 
            </ul>
        </div>
    </div>
    <% }%>
</div>
</div>
<hr>
<div class="fs-1 m-3 text-center text-white" id="totalPrice">total price: <b class="text-success-emphasis "><%= totalPrice %></b></div>
<hr>
<div class="row ">
    <% if (address.length >0) { %>
       <% for(let i in address){%>
            <div class=" mx-3 col col-sm-3 form-check">
                <input class="form-check-input" type="radio" value="<%=address[i].shipID %>" name="shipID" shipID id="<%=address[i].shipID%>">
                <label class="form-check-label" for="<%=address[i].shipID%>">
                    <div class="card">
                        <div class="card-body">
                          <h5 class="card-title"><%= address[i].type %></h5>
                          <h6 class="card-subtitle mb-2 text-body-secondary"><%= address[i].fullname%></h6>
                          <ul class="list-group list-group-flush">
                            <li class="list-group-item"><%= address[i].contactNo%></li>
                            <li class="list-group-item"><%= address[i].address%></li>
                            <li class="list-group-item"><%= address[i].zip +" "+ address[i].city %></li>
                            <li class="list-group-item"><%= address[i].state +" "+address[i].country %></li>
                          </ul>
                        </div>
                    </div>
                </label>
            </div>
    <% }%>
<%} %>

</div>
<hr>
<a class="btn btn-info col-12 fs-5" data-bs-toggle="collapse" href="#collapse" role="button" aria-expanded="false" >
    Add New Address 
</a>
<div id= "collapse"class=" collapse row mt-3 gradient-custom pt-3 pb-3" style="margin-top:25px ;">
    <div class="row align-items-center col-12 col-md-3">
            <div class="col text-center">
                <h3 class="col mt-3 text-white">Welcome</h3>
                <p class="col white-text">You are 30 seconds away from compleating your order!</p>
            </div>
    </div>
    <div class=" col-12 col-md-9 justify-content-center" >
        <div class="card card-custom pb-4">
            <div class="card-body mt-0 mx-2 mx-md-5">
                <div class="text-center mb-3 pb-2 mt-3">
                <h4 style="color: #495057 ;">Delivery Details</h4>
                </div>
                <form class="mb-2" method="POST" action="/saveAddress" >
                    <div class="row mb-4">
                        <div class="col-12 col-md-6">
                        <div class="form-outline">
                            <label class="form-label" for="form9Example1">Full name</label>
                            <input type="text" id="form9Example1" name="fullname" class="form-control input-custom" />
                        </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-outline">
                                <label class="form-label" for="typeEmail">Contact Number</label>
                                <input type="tel" id="typeEmail" name="contact" class="form-control input-custom" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-12 col-md-6">
                            <div class="form-outline">
                                <label class="form-label" for="form9Example6">Address</label>
                                <input type="text" id="form9Example6" name="address" class="form-control input-custom" />
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                        <div class="form-outline">
                            <label class="form-label" for="form9Example4">Zip</label>
                            <input type="text" id="form9Example4" name="zip" class="form-control input-custom" />
                        </div>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-12 col-md-6">
                            <div class="form-outline">
                                <label class="form-label" for="form9Example3">City</label>
                                <input type="text" id="form9Example3" name="city" class="form-control input-custom" />
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-outline">
                                <label class="form-label" for="state">State</label>
                                <input type="text" id="state" name="state" class="form-control input-custom" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-12 col-md-6">
                            <div class="form-outline">
                                <label class="form-label" for="country">Country</label>
                                <input type="tel" id="country" name="country" class="form-control input-custom" />
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-outline">
                                <label class="form-label" for="type">Type of address</label>
                                <input type="text" id="type" placeholder="home/office" name="type" class="form-control input-custom" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-4 justify-content-center">
                        <button class="btn btn-outline-primary col-12 col-md-6 fs-3 mt-3 "> Save Address</button>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
    </div>
    <div class="row mt-4">
        <p class="col fs-4" style="color: #A5D7E8;"> <b>Select payment method:</b></p>
        <div class="col fs-4 form-check">
            <input class="form-check-input" type="radio" value="COD" name="payMethod" id="COD" checked>
            <label class="form-check-label" for="COD">
            Cash On Delivery
        </label>
        </div>
        <div class="col fs-4 form-check">
            <input class="form-check-input" type="radio" value="online" name="payMethod" id="online">
            <label class="form-check-label" for="online">
                Online
            </label>
        </div>
    </div>
        <hr>
        
<button class="btn btn-primary col-12 mt-3 mb-3 fs-2" onclick="pay()" > Place Order:<%= totalPrice %> </button>
<!-- Optional JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
<script>

    function hideSuccess(el){
    el.classList.add("d-none")
    }
    function pay(){
        let shipID = document.querySelector('input[name="shipID"]:checked');
        let payMethod = document.querySelector('input[name="payMethod"]:checked');
        let amount = "<%= totalPrice %>"
        if(payMethod.value=="COD"){
            fetch(`/placeOrderCOD/${shipID.value}`,{
                method:'POST',
                headers: {
                    "Content-Type": "application/json",
                },
                body:JSON.stringify({bill:amount})
            })
            .then((res)=>res.text())
            .then((data)=>{
                document.write(data)
            })
        }else{
            fetch(`/payment`,{
                method:'POST',
                headers: {
                    "Content-Type": "application/json",
                },
                body:JSON.stringify({bill:amount})
            })  
            .then((res)=> res.json())
            .then((data)=>{
                var options = {
                    "key": "rzp_test_qGaDvWaJ1ytRkJ", // Enter the Key ID generated from the Dashboard
                    "amount": `${data.amount}`, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                    "currency": "INR",
                    "name": "LELO", //your business name
                    "description": "Test Transaction",
                    "image": "https://example.com/your_logo",
                    "order_id": data.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                    "callback_url": `/paymentVerify/${data.id}/${shipID.value}`,
                    "theme": {
                        "color": "#3399cc"
                    }
                };
                var rzp1 = new Razorpay(options);
                    rzp1.open();
                })
        }
    }

    
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>

</script>
</body>
</html>

